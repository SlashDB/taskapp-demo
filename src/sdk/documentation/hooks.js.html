<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hooks.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hooks.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Custom React hook for ease of state management with use of SlashDB and SDK.
 */
//Import React built-in hooks to use under the hood.
import { useState, useEffect, useContext, useRef } from 'react';
//Import vanilla JS class from SDK.
import { slashDB } from './slashdb';
//Import custom context for use of param passing thoughout project.
import { SlashDBContext } from './Context';

/**
 * Take values for baseUrl and setUpOptions passed to SlashDBContext via evoking.
 * SlashDBProvider at top level of user/client project and call method setUp passing
 * those params.
 */
export const useSetUp = () => {
  const { baseUrl, setUpOptions } = useContext(SlashDBContext);
  slashDB.setUp(baseUrl, setUpOptions);
};

/**
 * Hook for use of datadiscovery feature of SlashDB.
 *
 * @param {String} database Name of database to be accessed.
 * @param {array} defaultFilterParameters Array with names of resources to be accesed i.e. table name, column name, comlumn value
 * e.g. [Album, AlbumId, 1, Artist]
 * @param {Object} queryStrParameters Query params in key value pairs format to be sent via url e.g. {limit: 29} => ?limit=29
 * @returns {array} Array with data accessed (usually whole database)
 * and GET, POST, PUT and DELETE functions for interaction with the data accessed.
 */
export const useDataDiscovery = (
  database,
  defaultFilterParameters,
  queryStrParameters
) => {
  //Redundant call - in case user did not call useSetUp at top level of project
  useSetUp();

  const isMountedRef = useRef(null);

  const [data, setData] = useState([]);
  const [didUpdate, setDidUpdate] = useState(new Date().getTime());

  const handleSetData = (data) => {
    setData(data);
  };

  const handleUpdate = () => {
    setDidUpdate(new Date().getTime());
  };

  //filterParam rename
  /**
   *
   * @param {array} defaultFilterParameters Array with names of resources to be accesed i.e. table name, column name, comlumn value
   * eg. [Album, AlbumId, 1, Artist]
   * @param {Object} queryStrParameters Query params in key value pairs format to be sent via url e.g. {limit: 29} => ?limit=29
   * @param {Object} headers Any headers user may wish to pass.
   */
  const _get = async (filterParameters, queryStrParameters, headers) => {
    await slashDB
      .dataDiscovery(
        'get',
        database,
        filterParameters ? filterParameters : defaultFilterParameters,
        queryStrParameters,
        undefined,
        headers
      )
      .then((data) => handleSetData(data))
      .catch((error) => {
        console.log(error);
      });
  };

  /**
   *
   * @param {array} defaultFilterParameters Array with names of resources to be accesed i.e. table name, column name, comlumn value
   * e.g. [Album, AlbumId, 1, Artist]
   * @param {Object} body Payload to be delivered.
   * @param {Object} queryStrParameters Query params in key value pairs format to be send via url eg. {limit: 29} => ?limit=29
   * @param {Object} headers Any headers user may wish to pass.
   */
  const _post = async (filterParameters, body, queryStrParameters, headers) => {
    await slashDB
      .dataDiscovery(
        'post',
        database,
        filterParameters ? filterParameters : defaultFilterParameters,
        queryStrParameters,
        body,
        headers
      )
      .then(handleUpdate);
  };

  /**
   *
   * @param {array} defaultFilterParameters Array with names of resources to be accesed i.e. table name, column name, comlumn value
   * e.g. [Album, AlbumId, 1, Artist]
   * @param {Object} body Payload to be delivered.
   * @param {Object} queryStrParameters Query params in key value pairs format to be send via url e.g. {limit: 29} => ?limit=29
   * @param {Object} headers Any headers user may wish to pass.
   */
  const _put = async (filterParameters, body, queryStrParameters, headers) => {
    await slashDB
      .dataDiscovery(
        'put',
        database,
        filterParameters ? filterParameters : defaultFilterParameters,
        queryStrParameters,
        body,
        headers
      )
      .then(handleUpdate);
  };

  /**
   *
   * @param {array} defaultFilterParameters Array with names of resources to be accesed i.e. table name, column name, comlumn value
   * e.g. [Album, AlbumId, 1, Artist]
   * @param {Object} queryStrParameters Query params in key value pairs format to be send via url e.g. {limit: 29} => ?limit=29
   * @param {*} headers Any headers user may wish to pass.
   */
  const _delete = async (filterParameters, queryStrParameters, headers) => {
    await slashDB
      .dataDiscovery(
        'delete',
        database,
        filterParameters ? filterParameters : defaultFilterParameters,
        queryStrParameters,
        undefined,
        headers
      )
      .then(handleUpdate);
  };

  useEffect(() => {
    isMountedRef.current = true;
    if (isMountedRef.current) {
      _get(defaultFilterParameters, queryStrParameters);
    }
    return () => (isMountedRef.current = false);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [didUpdate]);

  return [data, _get, _post, _put, _delete];
};

/**
 * Function for executing query from slashDB server on a database
 *
 * @param {String} defHttpMethod GET, POST, PUT or DELETE - HTTP method to be used
 * @param {String} queryID ID/name of query as is in SlashDB server interface/config files
 * @param {Object} defParameters Params for query being executed e.g. if query requires itemID the pass object with key
 * value pair { itemID: `itemID_Value`,}.
 * @param {Object} defQueryStrParameters Query params in key value pairs format to be send via url eg. {limit: 29} => ?limit=29
 * @returns {array} [data, _executeQuery] data received as payload from response to query and function to be called for further
 * query execution
 */
export const useExecuteQuery = (
  defHttpMethod,
  queryID,
  defParameters,
  defQueryStrParameters
) => {
  //redundant call - in case user did not call useSetUp at top level of project
  useSetUp();

  const isMountedRef = useRef(null);

  const [data, setData] = useState([{}]);

  const handleDataSet = (data) => {
    setData(data);
  };

  /**
   * Function to be used for query execution after initial useExecuteQuery has been called
   *
   * @param {String} httpMethod GET, POST, PUT or DELETE - HTTP method to be used.
   * @param {array} parameters Any params user may wish to pass for query.
   * @param {Object} queryStrParameters Query params in key value pairs format to be send via url eg. {limit: 29} => ?limit=29
   * @param {Object} headers Any headers user may wish to pass.
   */
  const _executeQuery = async (
    httpMethod,
    parameters,
    queryStrParameters,
    headers
  ) => {
    await slashDB
      .executeQuery(
        httpMethod ? httpMethod : defHttpMethod,
        queryID,
        parameters ? defParameters : parameters,
        queryStrParameters ? defQueryStrParameters : queryStrParameters,
        headers
      )
      .then((data) => {
        handleDataSet(data);
      });
  };

  useEffect(() => {
    isMountedRef.current = true;
    if (isMountedRef.current) {
      _executeQuery(defHttpMethod, defParameters);
    }
    return () => (isMountedRef.current = false);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [defHttpMethod]);

  return [data, _executeQuery];
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#_delete">_delete</a></li><li><a href="global.html#authenticateCookieSessionLogin">authenticateCookieSessionLogin</a></li><li><a href="global.html#authenticateCookieSessionLogout">authenticateCookieSessionLogout</a></li><li><a href="global.html#dataDiscovery">dataDiscovery</a></li><li><a href="global.html#dataDiscoveryParamsConstructor">dataDiscoveryParamsConstructor</a></li><li><a href="global.html#delete_cookie">delete_cookie</a></li><li><a href="global.html#executeQuery">executeQuery</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#getIsAuthenticated">getIsAuthenticated</a></li><li><a href="global.html#handleResponse">handleResponse</a></li><li><a href="global.html#isAuthenticated">isAuthenticated</a></li><li><a href="global.html#post">post</a></li><li><a href="global.html#put">put</a></li><li><a href="global.html#queryParamsConstructor">queryParamsConstructor</a></li><li><a href="global.html#queryStrParamsConstructor">queryStrParamsConstructor</a></li><li><a href="global.html#raw">raw</a></li><li><a href="global.html#setCookie">setCookie</a></li><li><a href="global.html#setIsAuthenticated">setIsAuthenticated</a></li><li><a href="global.html#setUp">setUp</a></li><li><a href="global.html#SlashDBConsumer">SlashDBConsumer</a></li><li><a href="global.html#SlashDBContext">SlashDBContext</a></li><li><a href="global.html#SlashDBProvider">SlashDBProvider</a></li><li><a href="global.html#useDataDiscovery">useDataDiscovery</a></li><li><a href="global.html#useExecuteQuery">useExecuteQuery</a></li><li><a href="global.html#useSetUp">useSetUp</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Sep 01 2021 15:13:12 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
